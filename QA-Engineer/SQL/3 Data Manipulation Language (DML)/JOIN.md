`JOIN` в SQL — это операция, позволяющая объединять строки из двух или более таблиц на основе связанных между ними столбцов. Основные виды `JOIN` включают `INNER JOIN`, `LEFT JOIN`, `RIGHT JOIN` и `FULL JOIN`.

Для соединения строк из двух или более таблиц на основе связанного между ними столбца используется оператор `JOIN`. Он используется для объединения двух таблиц или получения данных оттуда. В SQL есть 4 типа соединения, а именно:

**INNER** (Внутреннее соединение): используется для возврата только совпадающих по ключу строк из нескольких таблиц, для которых выполняется условие соединения.

**LEFT** (Левое соединение): используется для возврата всех строк, совпадающих по ключу, из левой (первой) таблицы и только совпадающих строк из правой (второй) таблицы, для которых выполняется условие соединения.

**RIGHT** (Правое соединение): используется для возврата всех строк, совпадающих по ключу, из правой (второй) таблицы и только совпадающих строк из левой (первой) таблицы, для которых выполняется условие соединения.

**FULL** (Полное соединение): возвращает все записи, для которых есть совпадение по ключу в любой из таблиц. Следовательно, он возвращает все строки из левой таблицы и все строки из правой таблицы.

#### LEFT JOIN и INNER JOIN

`INNER JOIN` возвращает только те строки, которые имеют совпадающие значения в обоих соединяемых таблицах, в то время как `LEFT JOIN` возвращает все строки из левой таблицы и соответствующие строки из правой таблицы. Если в правой таблице нет совпадений, то результат будет содержать `NULL` значения для столбцов правой таблицы.

Внутреннее соединение — **INNER JOIN**

С помощью этого запроса вы возвратите все записи из таблиц `table_1` и `table_2`, которые связаны с помощью первичного (primary) и внешнего (foreign) ключей.

```
SELECT * FROM table_1
INNER JOIN table_2
ON table_1.primary_key = table_2.foreign_key
```

Если в какой-нибудь из вышеописанных таблиц отсутствует запись, которая соответствует соседней, эта пара не будет включена в общую выдачу. Таким образом, мы получим лишь те записи, которые существует как в первой, так и во второй таблицах. По сути, выборка осуществляется по наличию связи (ключу), то есть выдаются лишь записи, связанные между собой. Если у вас есть «одинокие» записи (записи без пары), то они выданы не будут.

Внешнее соединение — **LEFT JOIN**

С помощью этого запроса вы вернёте все данные из «левой» таблицы даже в том случае, если не будет найдено соответствий в «правой» таблице. Подразумевается, что «левая» таблица в запросе находится левее знака равно, а «правая», соответственно, правее (стандартная логика правой и левой руки).

```
SELECT * FROM table_1
LEFT JOIN table_2
ON table_1.primary_key = table_2.foreign_key
```

Говоря иначе, когда мы присоединяем «правую» таблицу к «левой», происходит выборка всех записей согласно условиям `WHERE` для «левой» таблицы. Если в «правой» таблице у нас отсутствуют соответствующие записи по ключам, они вернутся как `NULL`. В результате **главной выступает именно «левая» таблица**, и именно относительно неё осуществляется выдача. При этом в условии `ON` «левая» таблица прописывается первой по порядку (`table_1`), а «правая» – второй (`table_2`).

Подытоживая:

- `LEFT JOIN` — это абсолютно всё из левой таблицы, плюс то, что нашлось в правой (то, что удовлетворяет выражению `ON`). Если не нашлось в правой, то напротив записи из левой будет `NULL`;
- `INNER JOIN` — только те записи из левой и правой таблиц, которые удовлетворяют выражению `ON` (в обеих таблицах `NULL` недопустим);

#### Задача

Даны таблицы workers и departments:

```
CREATE TABLE departments (
    id int PRIMARY KEY,
    name VARCHAR(255)
);

CREATE TABLE workers (
    id int PRIMARY KEY,
    name VARCHAR(255),
    department_id int,
    FOREIGN KEY (department_id) REFERENCES departments (id)
);
```

Найдите все департаменты без единого сотрудника

```
SELECT d.name
FROM departments d
LEFT JOIN workers w ON w.department_id = d.id
WHERE w.name IS NULL;
```

Обратите внимание, что часть значений в столбце `w.name` будет пустыми, так как ни один сотрудник не состоит в данном департаменте.

Альтернативное решение:

```
SELECT d.name
FROM departments d
WHERE d.id NOT IN (
    SELECT department_id FROM workers
);
```

#### SELF JOIN

Self join в SQL – это тип операции соединения, при которой таблица объединяется сама с собой. Это полезно, когда у вас есть таблица со связанными данными в разных строках, которые вы хотите объединить на основе общего поля.

Например, рассмотрим таблицу `employees` со столбцами для ID и имени сотрудника, а также ID менеджера. Столбец ID менеджера содержит ID менеджера сотрудника. Чтобы получить список всех сотрудников с именем их менеджера, можно использовать self join.

```
SELECT e.name AS employee_name, m.name AS manager_name
FROM employees e
JOIN employees m ON e.manager_id = m.employee_id;
```

#### CROSS и NATURAL JOINы

Естественное соединение объединяет две таблицы на основе одного и того же имени атрибута и типов данных. `CROSS JOIN` производит перекрестное или декартово произведение двух таблиц.

В естественном соединении результирующая таблица будет содержать все атрибуты обеих таблиц, но сохранит только одну копию каждого общего столбца. В перекрестном соединении результирующая таблица будет содержать все атрибуты обеих таблиц, включая также повторяющиеся столбцы.

В естественном соединении, если условие не указано, он возвращает строки на основе общего столбца. В перекрестном соединении, если условие не указано, он возвращает все возможные пары строк из обеих таблиц, независимо от того, совпадают они или нет.